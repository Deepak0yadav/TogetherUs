/**
 * Gather Town-style pixel characters with male/female variants and walk animation.
 *
 * Each character: 16×24 logical pixels at 3× scale = 48×72px on screen.
 * Walk animation: 2 frames (legs alternate) per direction = 8 frames per gender.
 *
 * Pixel key:
 *   0  = transparent
 *   1  = hair dark
 *   2  = skin
 *   3  = shirt
 *   4  = pants
 *   5  = shoes
 *   6  = eyes
 *   7  = hair highlight
 *   8  = shirt shadow
 *   9  = skin shadow
 *   10 = shirt highlight
 *   11 = blush (female)
 */

const W = 16;
const H = 24;

function r(...cells) {
  const row = Array(W).fill(0);
  cells.forEach((v, i) => { if (i < W) row[i] = v; });
  return row;
}

// ─── MALE SPRITES ────────────────────────────────────────────────────────────

const MALE_DOWN = [
  r(0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 7, 7, 7, 7, 7, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 1, 7, 7, 7, 7, 7, 7, 7, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 2, 6, 2, 2, 2, 6, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 2, 2, 2, 9, 2, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 2, 2, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 9, 2, 2, 2, 9, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 0, 0, 0),
  r(0, 0, 2, 3, 3, 10, 3, 3, 3, 10, 3, 3, 2, 0, 0, 0),
  r(0, 0, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 5, 0, 5, 5, 5, 0, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 5, 5, 0, 5, 5, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const MALE_DOWN_WALK1 = [
  ...MALE_DOWN.slice(0, 17),
  r(0, 0, 0, 0, 4, 4, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 4, 4, 0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0),
  r(0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const MALE_DOWN_WALK2 = [
  ...MALE_DOWN.slice(0, 17),
  r(0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0, 4, 4, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0),
  r(0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const MALE_UP = [
  r(0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 1, 1, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 1, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0),
  r(0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 1, 9, 9, 9, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 9, 9, 9, 0, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 0, 0, 0),
  r(0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 0, 0, 0),
  r(0, 0, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 5, 0, 5, 5, 5, 0, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 5, 5, 0, 5, 5, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const MALE_LEFT = [
  r(0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 1, 7, 7, 7, 7, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 7, 7, 7, 7, 7, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 2, 6, 2, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 2, 2, 9, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 2, 2, 2, 2, 2, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 1, 9, 2, 9, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 1, 1, 1, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 9, 9, 0, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 2, 2, 0, 3, 3, 3, 10, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 2, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 2, 0, 8, 3, 3, 3, 3, 3, 8, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 4, 4, 0, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 4, 4, 0, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 4, 4, 0, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 4, 4, 0, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 5, 0, 5, 5, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 5, 5, 0, 5, 5, 5, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const MALE_RIGHT = MALE_LEFT.map((row) => [...row].reverse());

// ─── FEMALE SPRITES ──────────────────────────────────────────────────────────

const FEMALE_DOWN = [
  r(0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 1, 7, 7, 7, 7, 7, 7, 7, 1, 0, 0, 0, 0),
  r(0, 0, 1, 7, 7, 7, 7, 7, 7, 7, 7, 7, 1, 0, 0, 0),
  r(0, 0, 1, 7, 2, 2, 2, 2, 2, 2, 2, 7, 1, 0, 0, 0),
  r(0, 0, 1, 7, 2, 6, 2, 2, 2, 6, 2, 7, 1, 0, 0, 0),
  r(0, 0, 1, 7, 2, 2, 2, 9, 2, 2, 2, 7, 1, 0, 0, 0),
  r(0, 0, 1, 7, 2, 11, 2, 2, 2, 11, 2, 7, 1, 0, 0, 0),
  r(0, 0, 1, 7, 2, 2, 2, 2, 2, 2, 2, 7, 1, 0, 0, 0),
  r(0, 0, 1, 1, 7, 7, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0),
  r(0, 1, 1, 0, 0, 0, 9, 9, 9, 0, 0, 0, 1, 1, 0, 0),
  r(0, 1, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 1, 0, 0),
  r(0, 1, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 1, 0, 0),
  r(0, 0, 2, 3, 3, 10, 3, 3, 3, 10, 3, 3, 2, 0, 0, 0),
  r(0, 0, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 2, 2, 4, 0, 4, 2, 2, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 2, 2, 4, 0, 4, 2, 2, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 5, 0, 5, 5, 5, 0, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 5, 5, 0, 5, 5, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const FEMALE_DOWN_WALK1 = [
  ...FEMALE_DOWN.slice(0, 17),
  r(0, 0, 0, 0, 4, 4, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 4, 4, 0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 2, 2, 0, 0, 0, 0, 2, 2, 4, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 4, 4, 0, 0, 0, 0),
  r(0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const FEMALE_DOWN_WALK2 = [
  ...FEMALE_DOWN.slice(0, 17),
  r(0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 4, 4, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 0, 0, 0, 4, 4, 0, 0, 0),
  r(0, 0, 0, 0, 4, 2, 2, 0, 0, 0, 0, 2, 2, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 0, 0, 0, 0, 0, 5, 5, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 0, 0, 0, 0, 0, 5, 5, 5, 0, 0),
  r(0, 0, 0, 5, 5, 5, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const FEMALE_UP = [
  r(0, 0, 0, 0, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 1, 1, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0, 0),
  r(0, 0, 1, 1, 7, 7, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0),
  r(0, 0, 1, 1, 7, 7, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0),
  r(0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0),
  r(0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0),
  r(0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0),
  r(0, 0, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 1, 0, 0, 0),
  r(0, 0, 1, 1, 7, 7, 7, 7, 7, 7, 7, 1, 1, 0, 0, 0),
  r(0, 1, 1, 0, 0, 0, 9, 9, 9, 0, 0, 0, 1, 1, 0, 0),
  r(0, 1, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 1, 0, 0),
  r(0, 1, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 1, 0, 0),
  r(0, 0, 2, 3, 3, 3, 3, 3, 3, 3, 3, 3, 2, 0, 0, 0),
  r(0, 0, 2, 8, 3, 3, 3, 3, 3, 3, 3, 8, 2, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 3, 3, 3, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 4, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 4, 4, 4, 0, 4, 4, 4, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 2, 2, 4, 0, 4, 2, 2, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 2, 2, 4, 0, 4, 2, 2, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 5, 0, 5, 5, 5, 0, 0, 0, 0, 0),
  r(0, 0, 0, 5, 5, 5, 5, 0, 5, 5, 5, 5, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const FEMALE_LEFT = [
  r(0, 0, 0, 0, 0, 0, 1, 1, 1, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 7, 7, 7, 7, 7, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 7, 7, 7, 7, 7, 7, 7, 1, 0, 0, 0),
  r(0, 0, 0, 0, 1, 7, 2, 2, 2, 2, 7, 7, 1, 0, 0, 0),
  r(0, 0, 0, 0, 1, 7, 2, 6, 2, 2, 7, 7, 1, 0, 0, 0),
  r(0, 0, 0, 0, 1, 7, 2, 2, 9, 2, 7, 7, 1, 0, 0, 0),
  r(0, 0, 0, 0, 1, 7, 2, 11, 2, 2, 7, 7, 1, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 7, 2, 2, 7, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 1, 1, 7, 7, 1, 1, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 1, 0, 9, 9, 0, 1, 1, 0, 0, 0, 0),
  r(0, 0, 0, 0, 1, 3, 3, 3, 3, 3, 3, 1, 0, 0, 0, 0),
  r(0, 2, 2, 0, 1, 3, 3, 10, 3, 3, 3, 1, 0, 0, 0, 0),
  r(0, 0, 2, 0, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 2, 0, 0, 8, 3, 3, 3, 3, 8, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 3, 3, 3, 3, 3, 3, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 4, 4, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 4, 0, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 4, 0, 4, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 2, 0, 2, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 2, 0, 2, 4, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 5, 5, 0, 5, 5, 0, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 5, 5, 5, 0, 5, 5, 5, 0, 0, 0, 0, 0),
  r(0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0),
];

const FEMALE_RIGHT = FEMALE_LEFT.map((row) => [...row].reverse());

// ─── Grid helper ─────────────────────────────────────────────────────────────

function ensureGrid(grid) {
  const out = [];
  for (let i = 0; i < H; i++) {
    const row = grid[i];
    out.push(Array.isArray(row) && row.length >= W ? row.slice(0, W) : Array(W).fill(0));
  }
  return out;
}

// Walk frames: up/down have 2 walk frames, left/right share idle
const SPRITES = {
  male: {
    down:  [ensureGrid(MALE_DOWN), ensureGrid(MALE_DOWN_WALK1), ensureGrid(MALE_DOWN_WALK2)],
    up:    [ensureGrid(MALE_UP)],
    left:  [ensureGrid(MALE_LEFT)],
    right: [ensureGrid(MALE_RIGHT)],
  },
  female: {
    down:  [ensureGrid(FEMALE_DOWN), ensureGrid(FEMALE_DOWN_WALK1), ensureGrid(FEMALE_DOWN_WALK2)],
    up:    [ensureGrid(FEMALE_UP)],
    left:  [ensureGrid(FEMALE_LEFT)],
    right: [ensureGrid(FEMALE_RIGHT)],
  },
};

// ─── Palettes ────────────────────────────────────────────────────────────────

export const PALETTES = {
  amber: {
    hair: 0x3d2b1f, hairHL: 0x6b4226,
    skin: 0xf5c5a3, skinShadow: 0xe8a882,
    eye: 0x2c1810, blush: 0xf0a0a0,
    shirt: 0x3b82f6, shirtShadow: 0x2563eb, shirtHL: 0x60a5fa,
    pants: 0x1e3a5f, shoes: 0x1c1917,
  },
  rose: {
    hair: 0x7c1d4e, hairHL: 0xb45c82,
    skin: 0xfcd5b8, skinShadow: 0xf0a878,
    eye: 0x1a0a10, blush: 0xf8a0b0,
    shirt: 0xf472b6, shirtShadow: 0xdb2777, shirtHL: 0xfca5c0,
    pants: 0x4c1d35, shoes: 0x1a0a10,
  },
  teal: {
    hair: 0x1a3340, hairHL: 0x2d6070,
    skin: 0xe8d5b8, skinShadow: 0xd4b890,
    eye: 0x0a1820, blush: 0xe0a0a0,
    shirt: 0x14b8a6, shirtShadow: 0x0d9488, shirtHL: 0x5eead4,
    pants: 0x134e4a, shoes: 0x0d1a1a,
  },
  violet: {
    hair: 0x2d1b69, hairHL: 0x5b3b9e,
    skin: 0xf0d8c8, skinShadow: 0xd4b09b,
    eye: 0x1a0d3d, blush: 0xe8a8b8,
    shirt: 0x8b5cf6, shirtShadow: 0x7c3aed, shirtHL: 0xc4b5fd,
    pants: 0x2e1065, shoes: 0x1a0d3d,
  },
  sage: {
    hair: 0x1a2e1a, hairHL: 0x3d6b3d,
    skin: 0xdde8c8, skinShadow: 0xb8cc98,
    eye: 0x0d1a0d, blush: 0xc8b8a0,
    shirt: 0x4ade80, shirtShadow: 0x16a34a, shirtHL: 0x86efac,
    pants: 0x14532d, shoes: 0x0d1a0d,
  },
  coral: {
    hair: 0x4a1c1c, hairHL: 0x8b4040,
    skin: 0xfbd0aa, skinShadow: 0xf0a87a,
    eye: 0x2c1010, blush: 0xf0a0a0,
    shirt: 0xf97316, shirtShadow: 0xea580c, shirtHL: 0xfb923c,
    pants: 0x431407, shoes: 0x1c0a0a,
  },
};

const PIXEL_SCALE = 3;

// ─── Public API ──────────────────────────────────────────────────────────────

export function drawPixelCharacter(scene, x, y, paletteKey = 'amber', direction = 'down', gender = 'male', walkFrame = 0) {
  const pal = PALETTES[paletteKey] || PALETTES.amber;
  const colorMap = {
    1: pal.hair, 7: pal.hairHL, 2: pal.skin, 9: pal.skinShadow,
    6: pal.eye, 11: pal.blush || pal.skinShadow,
    3: pal.shirt, 8: pal.shirtShadow, 10: pal.shirtHL,
    4: pal.pants, 5: pal.shoes,
  };

  const genderSprites = SPRITES[gender] || SPRITES.male;
  const frames = genderSprites[direction] || genderSprites.down;
  const grid = frames[walkFrame % frames.length];

  const g = scene.add.graphics();
  g.x = x;
  g.y = y;
  const p = PIXEL_SCALE;

  for (let row = 0; row < H; row++) {
    for (let col = 0; col < W; col++) {
      const cell = grid[row][col];
      if (!cell) continue;
      const color = colorMap[cell];
      if (color === undefined) continue;
      g.fillStyle(color, 1);
      g.fillRect(col * p, row * p, p, p);
    }
  }
  return g;
}

export const AVATAR_PIXEL_SIZE = H * PIXEL_SCALE;
export const AVATAR_WIDTH = W * PIXEL_SCALE;
export const CHARACTER_PALETTES = Object.keys(PALETTES);
export const GENDERS = ['male', 'female'];
